<p>Om vi ​​visar de första 5 posterna i personaltabellen i schemat <strong>HR</strong></p><blockquote><p><code>SELECT EMPLOYEE_ID, FIRST_NAME, LAST_NAME, MANAGER_ID<br /> FRÅN anställda <br />HÄMT ENDAST 5 FÖRSTA RADER;</code></p></blockquote><table align="center" border="1" summary="Resultat från fråga"><tbody><tr> <th style="background-color:#9e9e9e; text-align:center">EMPLOYEE_ID</th><th style="background-color:#9e9e9e; text-align:center">FIRST_NAME</th><th style= "background-color:#9e9e9e; text-align:center">LAST_NAME</th><th style="background-color:#9e9e9e; text-align:center">MANAGER_ID</th></tr> <tr ><td>100</td><td>Steven</td><td>Kung</td><td>-</td></tr><tr><td>101</td> <td >Neena</td><td>Kochhar</td><td>100</td></tr><tr><td>102</td><td>Lex</td><td> De Haan </td><td>100</td></tr><tr><td>103</td><td>Alexander</td><td>Hunold</td><td>102< /td ></tr><tr><td>104</td><td>Bruce</td><td>Ernst</td><td>103</td></tr></tbody> </ table><p>vi kan se att det finns hierarkiska samband mellan dessa poster: <code>Steven King</code> är <code>Lex De Haan</code>s hierarkiska överordnade och han i sin tur är <code>Alexander Hunold</code>s hierarkiska överordnade.</p ><p>PostgreSQL tillåter oss att fråga de befintliga hierarkiska relationerna mellan tabellposter.</p><h3>Frågor med <code>WITH</code></h3><p>För att adressera hierarkiska frågor med PostgreSQL, först måste vi känna till den grundläggande operationen för <code>WITH</code></p><p><code>WITH</code> låter dig skriva hjälpsatser för att använda dem i stora frågor. Dessa påståenden, som ofta kallas <code>Common Table Expressions</code> eller <acronym class="acronym">CTE</acronym>s, kan tolkas som tillfälligt definierade tabeller som finns för en enda fråga. Varje hjälpsats i en <code>WITH</code>-sats kan vara en <code>SELECT</code>, <>INSERT</code>, <code>UPDATE</code> eller <code>DELETE</code> kod>; och själva satsen <code>WITH</code> är associerad med huvudfrågan som också kan vara en <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code> , eller <code>DELETE</code>.</p><h3>Exempel <code>WITH</code></h3><blockquote><p><code>MED VD SOM (VÄLJ * FRÅN anställda DÄR MANAGER_ID ÄR NULL)<br />VÄLJ FIRST_NAME, LAST_NAME FRÅN anställda WHERE MANAGER_ID IN (VÄLJ EMPLOYEE_ID FRÅN VD);</code></p></blockquote><blockquote><pre> first_name | efternamn ------------+----------- Neena | Kochhar Lex | De Haan Den | Raphael Matthew | Weiss-Adam | Fripp Payam | Kaufling Shanta | VollmanKevin | Mourgos John | RussellKaren | Albert Partners | Errazuriz Gerald | Cambrault Eleni | Zlotkey Michael | Hartstein (14 rader) </pre></blockquote><h3>Hierarkiskt frågeexempel:</h3><blockquote><pre><code> MED RECURSIVE managers AS ( SELECT EMPLOYEE_ID, FIRST_NAME, LAST_NAME, 1::integer LEVEL FRÅN anställda DÄR MANAGER_ID ÄR NULL -- Roten är den anställde med fältet manager_id som NULL UNION ALL SELECT subordinates.employee_id, subordinates.first_name, subordinates.last_name, managers.level + 1 FRÅN anställda underordnade JOIN managers ON managers.EMPLOYEE_ID = subordinates. -- Hur man går ner kasta hierarkin ) SELECT CONCAT(LPAD(' ', 10 * (LEVEL - 1), '-'),EMPLOYEE_ID) AS "HIERARCHICAL_LEVEL", FIRST_NAME, LAST_NAME FROM chefer;-- Visa dem < / code></pre></blockquote><blockquote><pre> HIERARCHICAL_LEVEL | förnamn | efternamn ------------------------------------+------------ - +------------- 100 | Steve | Kung ---------- 101 | älskling | Kochhar ---------- 102 | lex | De Haan ---------- 114 | ge | Raphaely ---------- 120 | Matthew | Weiss ---------- 121 | Adam | Fripp ---------- 122 | Payam | Kaufling ---------- 123 | Shanta | Vollmann ---------- 124 | Kevin | Mourgos ---------- 145 | John | Russell ---------- 146 | Karen | Partners ---------- 147 | Albert | Errazuriz ---------- 148 | Gerald | Cambrault ---------- 149 | Elena | Zlotkey ---------- 201 | Michael | Hartstein ------------------ 103 | Alexander | Hunold ------------------ 108 | Nancy | Greenberg ------------------ 115 | Alexander | Khoo </pre></blockquote><h3>Övning:</h3><p>Visar de befintliga hierarkiska relationerna som börjar med anställda på avdelningen som heter '<code>IT</code>'.</p>